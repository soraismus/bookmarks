[Flippin' Awesome](http://flippinawesome.org/ "Flippin' Awesome")
=================================================================

[15 Must read articles **](#)

April 15, 2014

-   [![Prepocessor\_Architecture\_header](http://flippinawesome.org/wp-content/uploads/2014/04/Prepocessor_Architecture_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
    [Organizing Your CSS Code for
    Preprocessors](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
-   [![es6\_header](http://flippinawesome.org/wp-content/uploads/2014/04/es6_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
    [ECMAScript 6: Jump in, the water is
    warm!](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
-   [![engaging\_games\_header](http://flippinawesome.org/wp-content/uploads/2014/04/engaging_games_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ten-engagement-strategies-to-increase-the-profitability-of-your-mobile-game/ "Ten Engagement Strategies to Increase the Profitability of Your Mobile Game")
    [Ten Engagement Strategies to Increase the Profitability of Your
    Mobile
    Game](http://flippinawesome.org/2014/04/14/ten-engagement-strategies-to-increase-the-profitability-of-your-mobile-game/ "Ten Engagement Strategies to Increase the Profitability of Your Mobile Game")
-   [![oculus\_header](http://flippinawesome.org/wp-content/uploads/2014/04/oculus_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/will-oculus-vr-and-amazon-fire-tv-change-web-app-development/ "Will Oculus VR and Amazon Fire TV Change Web App Development?")
    [Will Oculus VR and Amazon Fire TV Change Web App
    Development?](http://flippinawesome.org/2014/04/14/will-oculus-vr-and-amazon-fire-tv-change-web-app-development/ "Will Oculus VR and Amazon Fire TV Change Web App Development?")
-   [](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
    [Web Standards Library Update – Week of March 31,
    2014](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
-   [](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
    [Best of JavaScript, HTML & CSS – Week of March 31,
    2014](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
-   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
    [Improving Browser
    Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
-   [![html5\_games\_engine\_header](http://flippinawesome.org/wp-content/uploads/2014/04/html5_games_engine_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/lessons-learned-building-an-html5-games-engine/ "Lessons Learned Building an HTML5 Games Engine")
    [Lessons Learned Building an HTML5 Games
    Engine](http://flippinawesome.org/2014/04/07/lessons-learned-building-an-html5-games-engine/ "Lessons Learned Building an HTML5 Games Engine")
-   [![express\_routes\_header](http://flippinawesome.org/wp-content/uploads/2014/04/express_routes_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/the-basics-of-express-routes/ "The Basics of Express Routes")
    [The Basics of Express
    Routes](http://flippinawesome.org/2014/04/07/the-basics-of-express-routes/ "The Basics of Express Routes")
-   [](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
    [Web Standards Library Update – Week of March 24,
    2014](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
-   [](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
    [Best of JavaScript, HTML & CSS – Week of March 24,
    2014](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
-   [![choice\_header](http://flippinawesome.org/wp-content/uploads/2014/03/choice_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/paralyzed-by-choice-in-front-end-development/ "Paralyzed by Choice in Front-end Development")
    [Paralyzed by Choice in Front-end
    Development](http://flippinawesome.org/2014/03/31/paralyzed-by-choice-in-front-end-development/ "Paralyzed by Choice in Front-end Development")
-   [![npm\_header](http://flippinawesome.org/wp-content/uploads/2014/03/npm_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
    [Introduction to
    npm](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
-   [![oscillators\_header](http://flippinawesome.org/wp-content/uploads/2014/03/oscillators_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
    [Creating Sound with the Web Audio API and
    Oscillators](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
-   [](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")
    [Web Standards Library Update – Week of March 17,
    2014](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")

** [DW Focus](http://flippinawesome.org/ "DW Focus")

-   [**](https://www.facebook.com/flippin.awesome.dev "Facebook")
-   [**](http://twitter.com/remotesynth "Twitter")
-   [**](http://feeds.feedburner.com/FlippinAwesome "Rss")
-   [**](http://flippinawesome.org/wp-login.php?redirect_to=http%3A%2F%2Fflippinawesome.org%2F2014%2F01%2F20%2Fdependency-injection-in-javascript%2F "Login")

-   [About](http://flippinawesome.org/about/)**
    -   [Authors](http://flippinawesome.org/authors/)
    -   [Write for Us](http://flippinawesome.org/write-for-us/)

-   [Mailing List](http://flippinawesome.org/mailing-list/)
-   [Podcast](/topic-undefined/)**
    -   [Latest
        Episode](http://flippinawesome.org/topic-undefined/topic-undefined-episode-7/)

-   [Web Development](http://flippinawesome.org/category/web/)
    **
    -   [JavaScript](http://flippinawesome.org/category/web/javascript/)
    -   [CSS](http://flippinawesome.org/category/web/css/)
    -   [HTML](http://flippinawesome.org/category/web/html/)

    -   [![es6\_header](http://flippinawesome.org/wp-content/uploads/2014/04/es6_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
        [ECMAScript 6: Jump in, the water is
        warm!](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
        - 2 days ago
    -   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        [Improving Browser
        Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        - 1 week ago
    -   [![npm\_header](http://flippinawesome.org/wp-content/uploads/2014/03/npm_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
        [Introduction to
        npm](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
        - 2 weeks ago
    -   [![oscillators\_header](http://flippinawesome.org/wp-content/uploads/2014/03/oscillators_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
        [Creating Sound with the Web Audio API and
        Oscillators](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
        - 2 weeks ago
    -   [![string\_harmful](http://flippinawesome.org/wp-content/uploads/2014/03/string_harmful-110x110.jpg)](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        [String Templating Considered
        Harmful](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        - 3 weeks ago

    [View all](http://flippinawesome.org/category/web/javascript/)
    -   [![Prepocessor\_Architecture\_header](http://flippinawesome.org/wp-content/uploads/2014/04/Prepocessor_Architecture_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
        [Organizing Your CSS Code for
        Preprocessors](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
        - 2 days ago
    -   [![sass\_each\_header](http://flippinawesome.org/wp-content/uploads/2014/03/sass_each_header-110x110.jpg)](http://flippinawesome.org/2014/03/17/doing-more-with-sass-each-control-directive/ "Doing More with Sass’ @each Control Directive")
        [Doing More with Sass’ @each Control
        Directive](http://flippinawesome.org/2014/03/17/doing-more-with-sass-each-control-directive/ "Doing More with Sass’ @each Control Directive")
        - 4 weeks ago
    -   [![react\_grunt\_header](http://flippinawesome.org/wp-content/uploads/2014/03/react_grunt_header-110x110.jpg)](http://flippinawesome.org/2014/03/17/creating-modular-view-components-with-react-and-grunt/ "Creating Modular View Components with React and Grunt")
        [Creating Modular View Components with React and
        Grunt](http://flippinawesome.org/2014/03/17/creating-modular-view-components-with-react-and-grunt/ "Creating Modular View Components with React and Grunt")
        - 4 weeks ago
    -   [![sass\_control\_header](http://flippinawesome.org/wp-content/uploads/2014/02/sass_control_header-110x110.jpg)](http://flippinawesome.org/2014/03/03/getting-into-sass-control-directives/ "Getting into Sass Control Directives")
        [Getting into Sass Control
        Directives](http://flippinawesome.org/2014/03/03/getting-into-sass-control-directives/ "Getting into Sass Control Directives")
        - 1 month ago
    -   [![css\_grid\_header](http://flippinawesome.org/wp-content/uploads/2014/02/css_grid_header-110x110.jpg)](http://flippinawesome.org/2014/03/03/grids-in-css3/ "Grids in CSS3")
        [Grids in
        CSS3](http://flippinawesome.org/2014/03/03/grids-in-css3/ "Grids in CSS3")
        - 1 month ago

    [View all](http://flippinawesome.org/category/web/css/)
    -   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        [Improving Browser
        Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        - 1 week ago
    -   [![string\_harmful](http://flippinawesome.org/wp-content/uploads/2014/03/string_harmful-110x110.jpg)](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        [String Templating Considered
        Harmful](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        - 3 weeks ago
    -   [![dom\_access\_header](http://flippinawesome.org/wp-content/uploads/2014/03/dom_access_header-110x110.jpg)](http://flippinawesome.org/2014/03/10/a-dom-manipulation-class-in-100-lines-of-javascript/ "A DOM Manipulation Class in 100 Lines of JavaScript")
        [A DOM Manipulation Class in 100 Lines of
        JavaScript](http://flippinawesome.org/2014/03/10/a-dom-manipulation-class-in-100-lines-of-javascript/ "A DOM Manipulation Class in 100 Lines of JavaScript")
        - 1 month ago
    -   [![svg\_header](http://flippinawesome.org/wp-content/uploads/2014/02/svg_header-110x110.jpg)](http://flippinawesome.org/2014/02/03/learning-svg/ "Learning SVG")
        [Learning
        SVG](http://flippinawesome.org/2014/02/03/learning-svg/ "Learning SVG")
        - 2 months ago
    -   [![abbr\_header](http://flippinawesome.org/wp-content/uploads/2014/01/abbr_header-110x110.jpg)](http://flippinawesome.org/2014/01/13/enhancing-the-html-abbr-element-on-mobile/ "Enhancing the HTML abbr Element on Mobile")
        [Enhancing the HTML abbr Element on
        Mobile](http://flippinawesome.org/2014/01/13/enhancing-the-html-abbr-element-on-mobile/ "Enhancing the HTML abbr Element on Mobile")
        - 3 months ago

    [View all](http://flippinawesome.org/category/web/html/)
-   [Mobile Development](http://flippinawesome.org/category/mobile/)
    **
    -   [PhoneGap](http://flippinawesome.org/category/mobile/phonegap/)

    -   [![parallax\_mobile\_header](http://flippinawesome.org/wp-content/uploads/2013/12/parallax_mobile_header-110x110.jpg)](http://flippinawesome.org/2013/12/23/parallax-ui-for-phonegap-and-mobile-web-apps/ "Parallax UI for PhoneGap and Mobile Web Apps")
        [Parallax UI for PhoneGap and Mobile Web
        Apps](http://flippinawesome.org/2013/12/23/parallax-ui-for-phonegap-and-mobile-web-apps/ "Parallax UI for PhoneGap and Mobile Web Apps")
        - 4 months ago
    -   [![mapping\_phonegap\_header](http://flippinawesome.org/wp-content/uploads/2013/12/mapping_phonegap_header1-110x110.jpg)](http://flippinawesome.org/2013/12/09/mobile-friendly-mapping-for-phonegap-apps/ "Mobile-Friendly Mapping for PhoneGap Apps")
        [Mobile-Friendly Mapping for PhoneGap
        Apps](http://flippinawesome.org/2013/12/09/mobile-friendly-mapping-for-phonegap-apps/ "Mobile-Friendly Mapping for PhoneGap Apps")
        - 4 months ago
    -   [](http://flippinawesome.org/2013/04/29/phonegap-build-step-7/ "Create Your First Mobile App with PhoneGap Build – Using the Notification API")
        [Create Your First Mobile App with PhoneGap Build – Using the
        Notification
        API](http://flippinawesome.org/2013/04/29/phonegap-build-step-7/ "Create Your First Mobile App with PhoneGap Build – Using the Notification API")
        - 12 months ago
    -   [](http://flippinawesome.org/2013/04/22/phonegap-build-step-6/ "Create Your First Mobile App with PhoneGap Build – Using the Storage API")
        [Create Your First Mobile App with PhoneGap Build – Using the
        Storage
        API](http://flippinawesome.org/2013/04/22/phonegap-build-step-6/ "Create Your First Mobile App with PhoneGap Build – Using the Storage API")
        - 12 months ago
    -   [](http://flippinawesome.org/2013/04/15/phonegap-build-step-5/ "Create Your First Mobile App with PhoneGap Build – Adding Pages with jQuery Mobile")
        [Create Your First Mobile App with PhoneGap Build – Adding Pages
        with jQuery
        Mobile](http://flippinawesome.org/2013/04/15/phonegap-build-step-5/ "Create Your First Mobile App with PhoneGap Build – Adding Pages with jQuery Mobile")
        - 1 year ago

    [View all](http://flippinawesome.org/category/mobile/phonegap/)
-   [Responsive
    Design](http://flippinawesome.org/category/responsive-web-design/)

Dependency Injection in JavaScript
==================================

-   [Featured](http://flippinawesome.org/category/featured/ "View all posts in Featured")
-   [JavaScript](http://flippinawesome.org/category/web/javascript/ "View all posts in JavaScript")
-   [Web](http://flippinawesome.org/category/web/ "View all posts in Web")

January 20, 2014

![Dependency\_Injection\_Header](http://flippinawesome.org/wp-content/uploads/2014/01/Dependency_Injection_Header.jpg)

*By [Krasimir Tsonev](/authors/krasimir-tsonev)*

I like the quote that goes something like, “Programming is all about
managing complexity.” The computer world is a giant construction of
abstractions. We simply wrap things and produce new tools over and over
again. Just think for a minute. The languages which you use have
built-in functionality that are probably abstracted functions of other
low level operations. It’s the same with JavaScript.

Sooner or later you need to use abstractions made by other developers –
i.e. you depend on someone’s other code. I like dependency-free modules,
but that’s difficult to achieve. Even if you create those nice
black-box-like components you still have a part which combines
everything. That’s where the dependency injection comes in. The ability
to manage the dependencies effectively is absolutely necessary nowadays.
This articles sums up my observations on the problem and some of the
solutions.

The Goal
--------

Let’s say that we have two modules. The first one is a service which
makes Ajax requests and the second one is a router.

    var service = function() {
        return { name: 'Service' };
    }
    var router = function() {
        return { name: 'Router' };
    }

We have another function that needs these modules.

    var doSomething = function(other) {
        var s = service();
        var r = router();
    };

To make the things a little bit more interesting, the function needs to
accept one more parameter. Sure, we could use the above code, but that’s
not really flexible. What if we want to use `ServiceXML` or
`ServiceJSON`. Or what if we want to mockup some of the modules for
testing purposes. We can’t just edit the body of the function. The first
thing which we all come up with is to pass the dependencies as
parameters to the function. I.e.:

    var doSomething = function(service, router, other) {
        var s = service();
        var r = router();
    };

By doing this we are passing the exact implementation of the module
which we want. However this brings a new problem. Imagine if we have
`doSomething` all over our code. What will happen if we need a third
dependency. We can’t edit all the function’s calls.

What we need is an instrument which will do that for us. That’s what
dependency injectors are trying to solve. Let’s write down few goals
that our dependency injection solution should achieve:

-   We should be able to register dependencies;
-   The injector should accept a function and should return a function
    that somehow gets the needed resources;
-   We should not write a lot – we need short and nice syntax;
-   The injector should keep the scope of the passed function;
-   The passed function should be able to accept custom arguments, not
    only the described dependencies;

A nice list isn’t it. Let’s dive in.

The [RequireJS](http://requirejs.org/) / [AMD](http://requirejs.org/docs/whyamd.html) approach
----------------------------------------------------------------------------------------------

You probably already know about [RequireJS](http://requirejs.org/). It’s
a nice option for solving dependencies.

    define(['service', 'router'], function(service, router) {       
        // ...
    });

The idea is firstly to describe the needed dependencies and then write
your function. The order of the arguments is, of course, important here.
Let’s say that we write a module called `injector` which will accept the
same syntax.

    var doSomething = injector.resolve(['service', 'router'], function(service, router, other) {
        expect(service().name).to.be('Service');
        expect(router().name).to.be('Router');
        expect(other).to.be('Other');
    });
    doSomething("Other");

> Before to continue I should clarify the body of the `doSomething`
> function. I’m using
> [expect.js](https://github.com/LearnBoost/expect.js) as a assertion
> library just to be sure that the code which I’m writing works as I
> want. A little bit TDD approach.

Here is how our `injector` module starts. It’s good for it to be a
singleton, so it does its job from different parts of our application.

    var injector = {
        dependencies: {},
        register: function(key, value) {
            this.dependencies[key] = value;
        },
        resolve: function(deps, func, scope) {

        }
    }

This is a really simple object which has two functions and one variable
that acts as a storage. What we have to do is to check the `deps` array
and search for answers in the `dependencies` variable. The rest is just
calling the `.apply` method against the past `func` parameter.

    resolve: function(deps, func, scope) {
        var args = [];
        for(var i=0; i<deps.length, d=deps[i]; i++) {
            if(this.dependencies[d]) {
                args.push(this.dependencies[d]);
            } else {
                throw new Error('Can\'t resolve ' + d);
            }
        }
        return function() {
            func.apply(scope || {}, args.concat(Array.prototype.slice.call(arguments, 0)));
        }        
    }

If there is any scope it is effectively used.
`Array.prototype.slice.call(arguments, 0)` is necessary to transform the
`arguments` variable to an actual array. So far so good. Our test
passes. The problem with this implementation is that we have to write
the needed components twice and we can’t really mix their order. The
additional custom parameters are always after the dependencies.

The Reflection Approach
-----------------------

According to Wikipedia *reflection* is the ability of a program to
examine and modify the structure and behavior of an object at runtime.
In simple words and in the context of JavaScript, that’s reading the
source code of an object or function and analyzing it. Let’s get our
`doSomething` function from the beginning of the article. If you log
`doSomething.toString()` you will get the following string:

    "function (service, router, other) {
        var s = service();
        var r = router();
    }"

Having the method as a string gives us the ability to fetch the expected
parameters and, more importantly, their names. That’s what
[Angular](http://angularjs.org/) uses for its dependency injection
implementation. I cheated a bit and got the regular expression which
exports the arguments directly from the Angular’s code.

    /^function\s*[^\(]*\(\s*([^\)]*)\)/m

We could change the `resolve` class to the following:

    resolve: function() {
        var func, deps, scope, args = [], self = this;
        func = arguments[0];
        deps = func.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g, '').split(',');
        scope = arguments[1] || {};
        return function() {
            var a = Array.prototype.slice.call(arguments, 0);
            for(var i=0; i<deps.length; i++) {
                var d = deps[i];
                args.push(self.dependencies[d] && d != '' ? self.dependencies[d] : a.shift());
            }
            func.apply(scope || {}, args);
        }        
    }

We run the RegExp against the function’s definition. The result is:

    ["function (service, router, other)", "service, router, other"]

So, we need only the second item. Once we clean up the empty spaces and
split the string we got the `deps` array filled. There is only one more
change:

    var a = Array.prototype.slice.call(arguments, 0);
    ...
    args.push(self.dependencies[d] && d != '' ? self.dependencies[d] : a.shift());

We are looping through the dependencies and, if there is something
missing, trying to fetch it from the `arguments` object. Thankfully the
`shift` method returns simply `undefined` if the array is empty rather
than throwing an error. The new version of the `injector` could be used
like this:

    var doSomething = injector.resolve(function(service, other, router) {
        expect(service().name).to.be('Service');
        expect(router().name).to.be('Router');
        expect(other).to.be('Other');
    });
    doSomething("Other");

There is no need to rewrite the dependencies and their order can be
mixed. It still works and we replicated the Angular’s magic.

However, the world is not perfect and there is one very big problem with
this reflection type of injection. Minification will break our logic
because it changes the names of the parameters and we will no longerbe
able to resolve the dependencies. For example, a minified
`doSomething()` might look like this:

    var doSomething=function(e,t,n){var r=e();var i=t()}

The solution proposed by Angular’s team looks like that:

    var doSomething = injector.resolve(['service', 'router', function(service, router) {

    }]);

This looks like the solution which we started with. I personally wasn’t
able to find a better solution, and decided to mix the two approaches.
Here is the final version of the injector.

    var injector = {
        dependencies: {},
        register: function(key, value) {
            this.dependencies[key] = value;
        },
        resolve: function() {
            var func, deps, scope, args = [], self = this;
            if(typeof arguments[0] === 'string') {
                func = arguments[1];
                deps = arguments[0].replace(/ /g, '').split(',');
                scope = arguments[2] || {};
            } else {
                func = arguments[0];
                deps = func.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g, '').split(',');
                scope = arguments[1] || {};
            }
            return function() {
                var a = Array.prototype.slice.call(arguments, 0);
                for(var i=0; i<deps.length; i++) {
                    var d = deps[i];
                    args.push(self.dependencies[d] && d != '' ? self.dependencies[d] : a.shift());
                }
                func.apply(scope || {}, args);
            }        
        }
    }

The `resolve` method accepts two or three parameters. If there are two
parameters it acts like version wrote earlier in the article. However,
if there are three arguments it gets the first one, parses it and fills
the `deps` array. Here is the test case:

    var doSomething = injector.resolve('router,,service', function(a, b, c) {
        expect(a().name).to.be('Router');
        expect(b).to.be('Other');
        expect(c().name).to.be('Service');
    });
    doSomething("Other");

You will probably notice that there are two commas one after each other
– that’s not a typo. The empty value actually represents the `"Other"`
parameter. That’s how we will be able to control the order of the
parameters.

Injection Directly Into the Scope
---------------------------------

Sometimes I’m using a third variant of injection. It involves a
manipulation of the function’s scope (or in other words, the `this`
object). So, it is not always appropriate.

    var injector = {
        dependencies: {},
        register: function(key, value) {
            this.dependencies[key] = value;
        },
        resolve: function(deps, func, scope) {
            var args = [];
            scope = scope || {};
            for(var i=0; i<deps.length, d=deps[i]; i++) {
                if(this.dependencies[d]) {
                    scope[d] = this.dependencies[d];
                } else {
                    throw new Error('Can\'t resolve ' + d);
                }
            }
            return function() {
                func.apply(scope || {}, Array.prototype.slice.call(arguments, 0));
            }        
        }
    }

All we do is to attach the dependencies to the scope. The benefit here
is that the developer does not write the dependencies as parameters;
they are just part of the function’s scope.

    var doSomething = injector.resolve(['service', 'router'], function(other) {
        expect(this.service().name).to.be('Service');
        expect(this.router().name).to.be('Router');
        expect(other).to.be('Other');
    });
    doSomething("Other");

Final Words
-----------

The dependency injection is one of those things which most of us do, but
never really think about. Even if you didn’t know the term, you’ve
probably used it million of times before in your code. Hopefully this
article has given you a better understanding of how it works.

All the examples mentioned in this article can be found
[here](https://github.com/krasimir/blog-posts/tree/master/JavaScriptDependencyInjection).

*This article was originally published at
[http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScrip](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript)*[t](http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript)

Sharing

-   **[Twitter](https://twitter.com/intent/tweet?url=http%3A%2F%2Fflippinawesome.org%2F2014%2F01%2F20%2Fdependency-injection-in-javascript%2F&text=Dependency%20Injection%20in%20JavaScript)6
-   **[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fflippinawesome.org%2F2014%2F01%2F20%2Fdependency-injection-in-javascript%2F&t=Dependency%20Injection%20in%20JavaScript)0
-   **[Google
    +](https://plus.google.com/share?url=http%3A%2F%2Fflippinawesome.org%2F2014%2F01%2F20%2Fdependency-injection-in-javascript%2F)0
-   **[Linkedin](http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fflippinawesome.org%2F2014%2F01%2F20%2Fdependency-injection-in-javascript%2F&title=Dependency%20Injection%20in%20JavaScript&summary=By%20Krasimir%20Tsonev%20I%20like%20the%20quote%20that%20goes%20something%20like%2C%20%26%238220%3BProgramming%20is%20all%20about%20managing%20complexity.%26%238221%3B%20The%20computer%20world%20is%20a%20giant%20construction%20of%20abstractions.%20We%20simply%20wrap%20things%20and%20produce%20new%20tools%20over%20and%20over%20again.%20Just%20think%20for%20a%20minute.%20The%20languages%20which%20you%20use%20have%20built-in%20functionality%20that%20are%20probably%20abstracted%20%5B%26hellip%3B%5D)0
-   **[Email this
    article](mailto:?Subject=Dependency%20Injection%20in%20JavaScript)
-   **[Print this article](javascript:window.print();)

### One Comment;

1.  Pingback: [My links of the week – January 26, 2014 |
    R4](http://ruirib.net/blog/index.php/2014/01/my-links-of-the-week-january-26-2014/)

### [Cancel reply](/2014/01/20/dependency-injection-in-javascript/#respond)

**Your Name \*

**Your Email \*

**Website \*

### Web & Mobile Development News

[Web Standards Library Update – Week of March 31, 2014](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Best of JavaScript, HTML & CSS – Week of March 31, 2014](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Web Standards Library Update – Week of March 24, 2014](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Best of JavaScript, HTML & CSS – Week of March 24, 2014](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Web Standards Library Update – Week of March 17, 2014](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### Categories

-   [Best
    of](http://flippinawesome.org/category/news/best-of/ "View all posts filed under Best of")
-   [CSS](http://flippinawesome.org/category/web/css/ "View all posts filed under CSS")
-   [Design](http://flippinawesome.org/category/web/design/ "View all posts filed under Design")
-   [Featured](http://flippinawesome.org/category/featured/ "View all posts filed under Featured")
-   [Firefox
    OS](http://flippinawesome.org/category/mobile/firefox-os/ "View all posts filed under Firefox OS")
-   [Game
    Development](http://flippinawesome.org/category/web/game-development/ "View all posts filed under Game Development")
-   [HTML](http://flippinawesome.org/category/web/html/ "View all posts filed under HTML")
-   [JavaScript](http://flippinawesome.org/category/web/javascript/ "View all posts filed under JavaScript")
-   [Mobile](http://flippinawesome.org/category/mobile/ "View all posts filed under Mobile")
-   [News](http://flippinawesome.org/category/news/ "View all posts filed under News")
-   [NodeJS](http://flippinawesome.org/category/web/nodejs/ "View all posts filed under NodeJS")
-   [Opinion](http://flippinawesome.org/category/opinion/ "View all posts filed under Opinion")
-   [PhoneGap](http://flippinawesome.org/category/mobile/phonegap/ "View all posts filed under PhoneGap")
-   [Responsive Web
    Design](http://flippinawesome.org/category/responsive-web-design/ "View all posts filed under Responsive Web Design")
-   [Tools](http://flippinawesome.org/category/web/tools/ "View all posts filed under Tools")
-   [Web](http://flippinawesome.org/category/web/ "View all posts filed under Web")
-   [Wordpress](http://flippinawesome.org/category/web/wordpress/ "View all posts filed under Wordpress")

### Archives

-   [April 2014](http://flippinawesome.org/2014/04/)
-   [March 2014](http://flippinawesome.org/2014/03/)
-   [February 2014](http://flippinawesome.org/2014/02/)
-   [January 2014](http://flippinawesome.org/2014/01/)
-   [December 2013](http://flippinawesome.org/2013/12/)
-   [November 2013](http://flippinawesome.org/2013/11/)
-   [October 2013](http://flippinawesome.org/2013/10/)
-   [September 2013](http://flippinawesome.org/2013/09/)
-   [August 2013](http://flippinawesome.org/2013/08/)
-   [July 2013](http://flippinawesome.org/2013/07/)
-   [June 2013](http://flippinawesome.org/2013/06/)
-   [May 2013](http://flippinawesome.org/2013/05/)
-   [April 2013](http://flippinawesome.org/2013/04/)
-   [March 2013](http://flippinawesome.org/2013/03/)

-   [Flippin' Awesome](http://flippinawesome.org)
-   [Featured](http://flippinawesome.org/category/featured/)
-   Dependency Injection in JavaScript

Copyright © 2012.

All content is licensed under the [Creative Commons
Attribution-Noncommercial-Share Alike 3.0 Unported
License](http://creativecommons.org/licenses/by-nc-sa/3.0/).

[Flippin' Awesome](http://flippinawesome.org/ "Flippin' Awesome")

[Top](#masthead "Scroll to top")

This markdown document has been converted from the html document located at:
http://flippinawesome.org/2014/01/20/dependency-injection-in-javascript/
