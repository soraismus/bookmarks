[Flippin' Awesome](http://flippinawesome.org/ "Flippin' Awesome")
=================================================================

[15 Must read articles **](#)

April 15, 2014

-   [![Prepocessor\_Architecture\_header](http://flippinawesome.org/wp-content/uploads/2014/04/Prepocessor_Architecture_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
    [Organizing Your CSS Code for
    Preprocessors](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
-   [![es6\_header](http://flippinawesome.org/wp-content/uploads/2014/04/es6_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
    [ECMAScript 6: Jump in, the water is
    warm!](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
-   [![engaging\_games\_header](http://flippinawesome.org/wp-content/uploads/2014/04/engaging_games_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ten-engagement-strategies-to-increase-the-profitability-of-your-mobile-game/ "Ten Engagement Strategies to Increase the Profitability of Your Mobile Game")
    [Ten Engagement Strategies to Increase the Profitability of Your
    Mobile
    Game](http://flippinawesome.org/2014/04/14/ten-engagement-strategies-to-increase-the-profitability-of-your-mobile-game/ "Ten Engagement Strategies to Increase the Profitability of Your Mobile Game")
-   [![oculus\_header](http://flippinawesome.org/wp-content/uploads/2014/04/oculus_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/will-oculus-vr-and-amazon-fire-tv-change-web-app-development/ "Will Oculus VR and Amazon Fire TV Change Web App Development?")
    [Will Oculus VR and Amazon Fire TV Change Web App
    Development?](http://flippinawesome.org/2014/04/14/will-oculus-vr-and-amazon-fire-tv-change-web-app-development/ "Will Oculus VR and Amazon Fire TV Change Web App Development?")
-   [](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
    [Web Standards Library Update – Week of March 31,
    2014](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
-   [](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
    [Best of JavaScript, HTML & CSS – Week of March 31,
    2014](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
-   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
    [Improving Browser
    Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
-   [![html5\_games\_engine\_header](http://flippinawesome.org/wp-content/uploads/2014/04/html5_games_engine_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/lessons-learned-building-an-html5-games-engine/ "Lessons Learned Building an HTML5 Games Engine")
    [Lessons Learned Building an HTML5 Games
    Engine](http://flippinawesome.org/2014/04/07/lessons-learned-building-an-html5-games-engine/ "Lessons Learned Building an HTML5 Games Engine")
-   [![express\_routes\_header](http://flippinawesome.org/wp-content/uploads/2014/04/express_routes_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/the-basics-of-express-routes/ "The Basics of Express Routes")
    [The Basics of Express
    Routes](http://flippinawesome.org/2014/04/07/the-basics-of-express-routes/ "The Basics of Express Routes")
-   [](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
    [Web Standards Library Update – Week of March 24,
    2014](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
-   [](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
    [Best of JavaScript, HTML & CSS – Week of March 24,
    2014](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
-   [![choice\_header](http://flippinawesome.org/wp-content/uploads/2014/03/choice_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/paralyzed-by-choice-in-front-end-development/ "Paralyzed by Choice in Front-end Development")
    [Paralyzed by Choice in Front-end
    Development](http://flippinawesome.org/2014/03/31/paralyzed-by-choice-in-front-end-development/ "Paralyzed by Choice in Front-end Development")
-   [![npm\_header](http://flippinawesome.org/wp-content/uploads/2014/03/npm_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
    [Introduction to
    npm](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
-   [![oscillators\_header](http://flippinawesome.org/wp-content/uploads/2014/03/oscillators_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
    [Creating Sound with the Web Audio API and
    Oscillators](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
-   [](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")
    [Web Standards Library Update – Week of March 17,
    2014](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")

** [DW Focus](http://flippinawesome.org/ "DW Focus")

-   [**](https://www.facebook.com/flippin.awesome.dev "Facebook")
-   [**](http://twitter.com/remotesynth "Twitter")
-   [**](http://feeds.feedburner.com/FlippinAwesome "Rss")
-   [**](http://flippinawesome.org/wp-login.php?redirect_to=http%3A%2F%2Fflippinawesome.org%2F2014%2F02%2F10%2Freplacing-callbacks-with-es6-generators%2F "Login")

-   [About](http://flippinawesome.org/about/)**
    -   [Authors](http://flippinawesome.org/authors/)
    -   [Write for Us](http://flippinawesome.org/write-for-us/)

-   [Mailing List](http://flippinawesome.org/mailing-list/)
-   [Podcast](/topic-undefined/)**
    -   [Latest
        Episode](http://flippinawesome.org/topic-undefined/topic-undefined-episode-7/)

-   [Web Development](http://flippinawesome.org/category/web/)
    **
    -   [JavaScript](http://flippinawesome.org/category/web/javascript/)
    -   [CSS](http://flippinawesome.org/category/web/css/)
    -   [HTML](http://flippinawesome.org/category/web/html/)

    -   [![es6\_header](http://flippinawesome.org/wp-content/uploads/2014/04/es6_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
        [ECMAScript 6: Jump in, the water is
        warm!](http://flippinawesome.org/2014/04/14/ecmascript-6-jump-in-the-water-is-warm/ "ECMAScript 6: Jump in, the water is warm!")
        - 2 days ago
    -   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        [Improving Browser
        Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        - 1 week ago
    -   [![npm\_header](http://flippinawesome.org/wp-content/uploads/2014/03/npm_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
        [Introduction to
        npm](http://flippinawesome.org/2014/03/31/introduction-to-npm/ "Introduction to npm")
        - 2 weeks ago
    -   [![oscillators\_header](http://flippinawesome.org/wp-content/uploads/2014/03/oscillators_header-110x110.jpg)](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
        [Creating Sound with the Web Audio API and
        Oscillators](http://flippinawesome.org/2014/03/31/creating-sound-with-the-web-audio-api-and-oscillators/ "Creating Sound with the Web Audio API and Oscillators")
        - 2 weeks ago
    -   [![string\_harmful](http://flippinawesome.org/wp-content/uploads/2014/03/string_harmful-110x110.jpg)](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        [String Templating Considered
        Harmful](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        - 3 weeks ago

    [View all](http://flippinawesome.org/category/web/javascript/)
    -   [![Prepocessor\_Architecture\_header](http://flippinawesome.org/wp-content/uploads/2014/04/Prepocessor_Architecture_header-110x110.jpg)](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
        [Organizing Your CSS Code for
        Preprocessors](http://flippinawesome.org/2014/04/14/organizing-your-css-code-for-preprocessors/ "Organizing Your CSS Code for Preprocessors")
        - 2 days ago
    -   [![sass\_each\_header](http://flippinawesome.org/wp-content/uploads/2014/03/sass_each_header-110x110.jpg)](http://flippinawesome.org/2014/03/17/doing-more-with-sass-each-control-directive/ "Doing More with Sass’ @each Control Directive")
        [Doing More with Sass’ @each Control
        Directive](http://flippinawesome.org/2014/03/17/doing-more-with-sass-each-control-directive/ "Doing More with Sass’ @each Control Directive")
        - 4 weeks ago
    -   [![react\_grunt\_header](http://flippinawesome.org/wp-content/uploads/2014/03/react_grunt_header-110x110.jpg)](http://flippinawesome.org/2014/03/17/creating-modular-view-components-with-react-and-grunt/ "Creating Modular View Components with React and Grunt")
        [Creating Modular View Components with React and
        Grunt](http://flippinawesome.org/2014/03/17/creating-modular-view-components-with-react-and-grunt/ "Creating Modular View Components with React and Grunt")
        - 4 weeks ago
    -   [![sass\_control\_header](http://flippinawesome.org/wp-content/uploads/2014/02/sass_control_header-110x110.jpg)](http://flippinawesome.org/2014/03/03/getting-into-sass-control-directives/ "Getting into Sass Control Directives")
        [Getting into Sass Control
        Directives](http://flippinawesome.org/2014/03/03/getting-into-sass-control-directives/ "Getting into Sass Control Directives")
        - 1 month ago
    -   [![css\_grid\_header](http://flippinawesome.org/wp-content/uploads/2014/02/css_grid_header-110x110.jpg)](http://flippinawesome.org/2014/03/03/grids-in-css3/ "Grids in CSS3")
        [Grids in
        CSS3](http://flippinawesome.org/2014/03/03/grids-in-css3/ "Grids in CSS3")
        - 1 month ago

    [View all](http://flippinawesome.org/category/web/css/)
    -   [![browser\_detection\_header](http://flippinawesome.org/wp-content/uploads/2014/04/browser_detection_header-110x110.jpg)](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        [Improving Browser
        Detection](http://flippinawesome.org/2014/04/07/improving-browser-detection/ "Improving Browser Detection")
        - 1 week ago
    -   [![string\_harmful](http://flippinawesome.org/wp-content/uploads/2014/03/string_harmful-110x110.jpg)](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        [String Templating Considered
        Harmful](http://flippinawesome.org/2014/03/24/string-templating-considered-harmful/ "String Templating Considered Harmful")
        - 3 weeks ago
    -   [![dom\_access\_header](http://flippinawesome.org/wp-content/uploads/2014/03/dom_access_header-110x110.jpg)](http://flippinawesome.org/2014/03/10/a-dom-manipulation-class-in-100-lines-of-javascript/ "A DOM Manipulation Class in 100 Lines of JavaScript")
        [A DOM Manipulation Class in 100 Lines of
        JavaScript](http://flippinawesome.org/2014/03/10/a-dom-manipulation-class-in-100-lines-of-javascript/ "A DOM Manipulation Class in 100 Lines of JavaScript")
        - 1 month ago
    -   [![svg\_header](http://flippinawesome.org/wp-content/uploads/2014/02/svg_header-110x110.jpg)](http://flippinawesome.org/2014/02/03/learning-svg/ "Learning SVG")
        [Learning
        SVG](http://flippinawesome.org/2014/02/03/learning-svg/ "Learning SVG")
        - 2 months ago
    -   [![abbr\_header](http://flippinawesome.org/wp-content/uploads/2014/01/abbr_header-110x110.jpg)](http://flippinawesome.org/2014/01/13/enhancing-the-html-abbr-element-on-mobile/ "Enhancing the HTML abbr Element on Mobile")
        [Enhancing the HTML abbr Element on
        Mobile](http://flippinawesome.org/2014/01/13/enhancing-the-html-abbr-element-on-mobile/ "Enhancing the HTML abbr Element on Mobile")
        - 3 months ago

    [View all](http://flippinawesome.org/category/web/html/)
-   [Mobile Development](http://flippinawesome.org/category/mobile/)
    **
    -   [PhoneGap](http://flippinawesome.org/category/mobile/phonegap/)

    -   [![parallax\_mobile\_header](http://flippinawesome.org/wp-content/uploads/2013/12/parallax_mobile_header-110x110.jpg)](http://flippinawesome.org/2013/12/23/parallax-ui-for-phonegap-and-mobile-web-apps/ "Parallax UI for PhoneGap and Mobile Web Apps")
        [Parallax UI for PhoneGap and Mobile Web
        Apps](http://flippinawesome.org/2013/12/23/parallax-ui-for-phonegap-and-mobile-web-apps/ "Parallax UI for PhoneGap and Mobile Web Apps")
        - 4 months ago
    -   [![mapping\_phonegap\_header](http://flippinawesome.org/wp-content/uploads/2013/12/mapping_phonegap_header1-110x110.jpg)](http://flippinawesome.org/2013/12/09/mobile-friendly-mapping-for-phonegap-apps/ "Mobile-Friendly Mapping for PhoneGap Apps")
        [Mobile-Friendly Mapping for PhoneGap
        Apps](http://flippinawesome.org/2013/12/09/mobile-friendly-mapping-for-phonegap-apps/ "Mobile-Friendly Mapping for PhoneGap Apps")
        - 4 months ago
    -   [](http://flippinawesome.org/2013/04/29/phonegap-build-step-7/ "Create Your First Mobile App with PhoneGap Build – Using the Notification API")
        [Create Your First Mobile App with PhoneGap Build – Using the
        Notification
        API](http://flippinawesome.org/2013/04/29/phonegap-build-step-7/ "Create Your First Mobile App with PhoneGap Build – Using the Notification API")
        - 12 months ago
    -   [](http://flippinawesome.org/2013/04/22/phonegap-build-step-6/ "Create Your First Mobile App with PhoneGap Build – Using the Storage API")
        [Create Your First Mobile App with PhoneGap Build – Using the
        Storage
        API](http://flippinawesome.org/2013/04/22/phonegap-build-step-6/ "Create Your First Mobile App with PhoneGap Build – Using the Storage API")
        - 12 months ago
    -   [](http://flippinawesome.org/2013/04/15/phonegap-build-step-5/ "Create Your First Mobile App with PhoneGap Build – Adding Pages with jQuery Mobile")
        [Create Your First Mobile App with PhoneGap Build – Adding Pages
        with jQuery
        Mobile](http://flippinawesome.org/2013/04/15/phonegap-build-step-5/ "Create Your First Mobile App with PhoneGap Build – Adding Pages with jQuery Mobile")
        - 1 year ago

    [View all](http://flippinawesome.org/category/mobile/phonegap/)
-   [Responsive
    Design](http://flippinawesome.org/category/responsive-web-design/)

Replacing callbacks with ES6 Generators
=======================================

-   [Featured](http://flippinawesome.org/category/featured/ "View all posts in Featured")
-   [JavaScript](http://flippinawesome.org/category/web/javascript/ "View all posts in JavaScript")
-   [Web](http://flippinawesome.org/category/web/ "View all posts in Web")

February 10, 2014

![generators\_turnomatic\_header](http://flippinawesome.org/wp-content/uploads/2014/02/generators_turnomatic_header.jpg)

*By [Matt Baker](/authors/matt-baker/)*

There are a lot of articles out there discussing the use of [ES6
generators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#Generators.3A_a_better_way_to_build_Iterators)
to remove the “callback pyramid” we so often encounter in JavaScript.
Unfortunately, most of them rely on libraries, and few tell the whole
story.

In this article we’re going to go step-by-step. We’ll progressively
modify a toy callback-based example towards a generator-based solution.
The goal is for you to understand how the entire process works, from end
to end.

Generators are a new concept in JavaScript, but not in programming. You
might have used them in other languages like Python. If not, have no
fear, we’re going to do a gentle intro.

### How to run the examples

Before we get started, you will need [Node
0.11.\*](http://blog.nodejs.org/2014/01/28/node-v0-11-11-unstable/) to
run the examples. When you run the examples, you must tell Node to run
with ES6 (a.k.a. Harmony) support: `node --harmony example.js`.

### What is a generator?

Before we dive in to how to use generators in place of callbacks, let’s
talk about generators *are*.

Generators are a lot like functions, except you can pause their
execution. You can ask them for a value and they’ll provide one, but the
rest of the function won’t execute until you ask it for a value again.

[![icon\_28196\_67](http://flippinawesome.org/wp-content/uploads/2014/02/icon_28196_67.png)](http://flippinawesome.org/wp-content/uploads/2014/02/icon_28196_67.png)
Take-a-number ticketing machines are actually a good metaphor for
generators. You can ask the ticketing machine for a value by pulling a
ticket. You receive your number, but it doesn’t hand you the next one.
In other words, the ticket machine “pauses” until someone requests
another number, at which point is advances to the next one.

### Generators in ES6

Generators in ES6 are declared like functions, except they have an
asterisk:

    function* ticketGenerator() {}

When you want a generator to provide a value and then pause you use the
`yield` keyword. `yield` is like `return` in that it hands back a value,
except the function pauses after yield is called.

    function* ticketGenerator() {
      yield 1;
      yield 2;
      yield 3;
    }

In our example we’ve defined an iterator called `ticketGenerator`. If we
ask it for a value, it will return `1` and then pause. If we ask it
again, we’ll get two, and finally 3.

When you call a generator (e.g. `ticketGenerator()`), it returns a new
[Iterator](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#Iterators)
object. This iterator object has a method called `next` which allows you
to unpause your generator function and get the next value.

`next` returns more than just the value, it returns an object with two
properties: `done` and `value`. `value` is what you’ve yielded, `done`
says whether or not your generator is done providing values.

Let’s pull a few numbers from our ticket machine:

    var takeANumber = ticketGenerator();
    takeANumber.next(); 
    // > { value: 1, done: false }
    takeANumber.next(); 
    // > { value: 2, done: false }
    takeANumber.next(); 
    // > { value: 3, done: false }
    takeANumber.next(); 
    // > { value: undefined, done: true }

Right now our ticketing system only goes up to 3, which isn’t very
useful. We’d like it to increment indefinitely, so let’s create a loop.

    function* ticketGenerator() {
      for(var i=0; true; i++) {
        yield i;
      }
    }

Now, if this were a function and we were using `return` we’d get back
`0` every time. Not so with a generator:

    var takeANumber = ticketGenerator();
    console.log(takeANumber.next().value); //0
    console.log(takeANumber.next().value); //1
    console.log(takeANumber.next().value); //2
    console.log(takeANumber.next().value); //3
    console.log(takeANumber.next().value); //4

Each time we call `next()` our generator executes another iteration of
our loop and then pauses. This means you can have generators that, like
ours, run infinitely. Because the generator pauses, you won’t freeze
your program. In fact, generators are a perfect way of representing
infinite sequences.

#### Affecting the generator’s state

In addition to advancing the iterator-generator object, `next()`
actually has a secondary use. If you pass a value to `next`, it will be
treated as the *result* of a yield statement *inside the generator*.

So `next` is sort of a way of passing information in to the generator in
the middle of its execution. We’re going to use that fact to enhance our
ticket generator so that it can be reset back to zero. We want to be
able to tell it to reset itself at any point in time.

    function* ticketGenerator() {
      for(var i=0; true; i++) {
        var reset = yield i;
        if(reset) { i = -1; }
      }
    }

As you can see, if `yield` returns `true` then we set `i` to -1. The for
loop will increment `i` at the end of the loop, so the next time it is
yielded, `i` will be zero.

Don’t get confused. `yield i` *sends* `i` out of the generator, but the
result of `yield i` in our generator is the value provided by `next`.

Let’s look at it in action:

    var takeANumber = ticketGenerator();
    console.log(takeANumber.next().value); //0
    console.log(takeANumber.next().value); //1
    console.log(takeANumber.next().value); //2
    console.log(takeANumber.next(true).value); //0
    console.log(takeANumber.next().value); //1

### Replacing Callbacks with Generators

Now that we have some knowledge of generators under our belts, let’s
talk about about generators and callbacks. As you know, we typically use
callbacks when we’re calling asynchronous code like AJAX requests. For
simplicity’s sake I’d like to define a `delay` function for use in our
examples.

Our `delay` function will be asynchronous – after a certain number of
milliseconds the callback you provide to `delay` will be executed, and
`delay` will pass your callback a string telling it how long it slept.

In the mean time your other code will keep executing. This is *just*
like making an AJAX request – you make the request, your code keeps
executing, and your callback runs when the server comes back with a
result.

So, let’s define `delay`:

    function delay(time, callback) {
      setTimeout(function () {
        callback("Slept for "+time);
      }, time);
    }

Nothing special there. Now let’s use it to delay twice. First we’ll
delay for 1000ms, and when that completes we’ll delay for another
1200ms.

    delay(1000, function(msg) {
      console.log(msg);
      delay(1200, function (msg) {
          console.log(msg);
        }
    })
    //...waits 1000ms
    // > "Slept for 1000"
    //...waits another 1200ms
    // > "Slept for 1200"

The only way to ensure that our two `delay` calls are executed one after
the other is to make our second `delay` call in the callback of the
first.

If we needed to delay 12 times, one after the other, we would need to
call `delay` in 12 nested callbacks. This is when you end up with the
“callback pyramid”, and things start to get ugly.

#### Enter Generators

Generators are one approach to eliminating “callback hell”. Asynchronous
calls are tough because our functions don’t wait for the async call to
complete, hence the need for callbacks.

With generators, we can *make* our code wait. Instead of nested
callbacks, we can use generators to *pause their execution* while each
asynchronous call finishes before we ask the generator function to
advance to the next line of code.

So, if we can pause execution while an asynchronous call completes, that
means we can make calls to `delay` one after another – as if `delay` is
actually synchronous.

#### So how do we do it?

First, we know that our code that makes asynchronous calls needs to
happen in a generator instead of a typical function, so let’s define
one.

    function* myDelayedMessages() {
        /* delay 1000 ms and print the result */
        /* delay 1200 ms and print the result */
    }

Next we need to call `delay` in our generator. Remember, `delay` takes a
callback. That callback will need to advance our generator, but we don’t
have one yet so we’re going to put in an empty function.

    function* myDelayedMessages() {
        console.log(delay(1000, function(){}));
        console.log(delay(1200, function(){}));
    }

Our code is still asynchronous. That’s because we haven’t put any
`yield` statements in. Generators only pause when they see a `yield`
statement!

    function* myDelayedMessages() {
        console.log(yield delay(1000, function(){}));
        console.log(yield delay(1200, function(){}));
    }

We’re getting closer now. However, if we run our generator it won’t
actually do anything. Nothing is telling it to advance.

The crucial concept for you to understand is right here: the generator
is supposed to advance when the callback provided to `delay` completes,
that’s how it knows to unpause.

This means that whatever’s in that callback needs to know how to push
the generator forward. Let’s pass in a function called `resume` that
does this for us. Keep in mind that we haven’t defined `resume` yet.

    function* myDelayedMessages(resume) {
        console.log(yield delay(1000, resume));
        console.log(yield delay(1200, resume));
    }

Ok, our generator will take a `resume` function that will advance it,
and we’re passing that to `delay`.

Now the tricky part, how do we write `resume`, and how does it know
about our generator?

If you look at other examples of code that use generators to replace
callbacks, you’ll see that the generator functions are always wrapped by
another function – often something called “run” or “execute.” The
purpose of these `run` functions is to do the following:

-   Accept a generator as an argument
-   Use the generator to create a new generator-iterator object that we
    can call `next()` on.
-   Create a `resume` function that uses the generator-iterator object
    to advance the generator.
-   Pass `resume` to the generator so that it has access to it.
-   Kicks things off by calling `next()` *once* at the very beginning,
    so that our code can start executing before hitting the first
    `yield`.

Let’s build up `run`.

    function run(generatorFunction) {
        var generatorItr = generatorFunction(resume);
        function resume(callbackValue) {
            generatorItr.next(callbackValue);
        }
        generatorItr.next()
    }

Now we have a function that can take a generator function and pass it a
function that knows how to advance the generator-iterator object it
creates.

Note that we’re using the second ability of `next` in our `resume`
function. `resume` is the callback passed to `delay`, so it will receive
the value `delay` provides. `resume` passes that value on to `next`, so
that the result of the `yield` statement is actually the result of our
asynchronous function!

All we have to do now is wrap our own generator function with `run` and
we should be set:

    run(function* myDelayedMessages(resume) {
        console.log(yield delay(1000, resume));
        console.log(yield delay(1200, resume));
    })
    //...waits 1000ms
    // > "Slept for 1000"
    //...waits 1200ms
    // > "Slept for 1200"

There we go. You can see that we call `delay` twice without any callback
nesting. If you’re still confused, let’s explain what’s happening at a
high level step-by-step.

-   `run` takes our generator and creates a `resume` function.
-   `run` creates a generator-iterator object (the thing you call `next`
    on), providing `resume`. Then it advances the generator-iterator one
    step to kick everything off.
-   Our generator encounters the first `yield` statement and calls
    `delay`. Then the generator pauses.
-   `delay` completes 1000ms later and calls `resume`.
-   `resume` tells our generator to advance a single step. It passes the
    result of `delay` on so that the console can log it out.
-   Our generator encounters the second call to yield, calls `delay` and
    pauses again.
-   `delay` waits 1200ms and ultimately calls the `resume` callback.
-   `resume` advances the generator again.
-   There are no more calls to `yield`, the generator finishes
    executing.

Conclusion
----------

We’ve successfully replaced nested callbacks with a generator-based
solution. Just to recap, replacing callbacks with generators consists of
the following:

-   Creating a `run` function that takes a generator, and provides it a
    `resume` function.
-   Creating a `resume` function that advances that generator by a
    single step, and passes the generator whatever value `resume` is
    called with by the asynchronous function
-   Passing `resume` as the callback to all of our asynchronous calls.
    Those async functions execute `resume` when they complete, allowing
    our generator to only advance after each async call completes.

Whether generators are a *good* approach to handling “callback hell” is
debateable, but it’s a great exercise to expand your understanding of
generators and iterators in ES6. If you’re looking for a practical
solution for dealing with your asynchronous code that doesn’t require
ES6, consider promises. I’ve written about jQuery’s promise
implementation (aka “deferred”)
[here](http://eng.wealthfront.com/2012/12/jquerydeferred-is-most-important-client.html).

Sharing

-   **[Twitter](https://twitter.com/intent/tweet?url=http%3A%2F%2Fflippinawesome.org%2F2014%2F02%2F10%2Freplacing-callbacks-with-es6-generators%2F&text=Replacing%20callbacks%20with%20ES6%20Generators)2
-   **[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fflippinawesome.org%2F2014%2F02%2F10%2Freplacing-callbacks-with-es6-generators%2F&t=Replacing%20callbacks%20with%20ES6%20Generators)0
-   **[Google
    +](https://plus.google.com/share?url=http%3A%2F%2Fflippinawesome.org%2F2014%2F02%2F10%2Freplacing-callbacks-with-es6-generators%2F)0
-   **[Linkedin](http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fflippinawesome.org%2F2014%2F02%2F10%2Freplacing-callbacks-with-es6-generators%2F&title=Replacing%20callbacks%20with%20ES6%20Generators&summary=By%20Matt%20Baker%20There%20are%20a%20lot%20of%20articles%20out%20there%20discussing%20the%20use%20of%20ES6%20generators%20to%20remove%20the%20%26%238220%3Bcallback%20pyramid%26%238221%3B%20we%20so%20often%20encounter%20in%20JavaScript.%20Unfortunately%2C%20most%20of%20them%20rely%20on%20libraries%2C%20and%20few%20tell%20the%20whole%20story.%20In%20this%20article%20we%26%238217%3Bre%20going%20to%20go%20step-by-step.%20We%26%238217%3Bll%20progressively%20modify%20a%20toy%20callback-based%20%5B%26hellip%3B%5D)0
-   **[Email this
    article](mailto:?Subject=Replacing%20callbacks%20with%20ES6%20Generators)
-   **[Print this article](javascript:window.print();)

### 8 Comments

1.  ![image](http://1.gravatar.com/avatar/51c857a1463c0c1cd8a143f43c6509da?s=44&d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)[odf](http://github.com/odf)
    [8 hours
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-14542)
    said:

    Great article! I have to confess I’ve had a hard time reading other
    people’s code for this kind of stuff even after implementing a
    generator-based async library myself. So kudos for breaking it down
    so nicely.

    Personally, I’ve come to the conclusion that this approach can be
    made entirely practical with proper library support. Even the fact
    that ES6 is not yet widely available is not a serious drawback due
    to tools like regenerator and traceur.

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=14542#respond)
    **

2.  ![image](http://1.gravatar.com/avatar/5ed97e218a66a41e65b7f81dd131832c?s=44&d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)[Justin
    McCandless](http://www.justinmccandless.com) [3 hours
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-14837)
    said:

    I went in to the article not understanding generators and thinking
    they must be superfluous, and finished it with an understanding and
    appreciation. Great article.

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=14837#respond)
    **

3.  Pingback: [Articles for 2014-feb-17 | Readings for a
    day](http://readings.grelution.com/?p=90)

4.  ![image](http://1.gravatar.com/avatar/bcad85a0d0f1b5ac8fb904d59bc064c9?s=44&d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)[Thomas
    Burleson](http://solutionOptimist.com) [53 seconds
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-15056)
    said:

    Personally I like using Promises for flattening the \`async callback
    pyramid\`. While nicely articulated, your Generator example seems
    more easily solved with Promises.

    But I realize that Promises are not the universal \`hammer\` for all
    construction. Can you recommend other applications of Generators ?

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=15056#respond)
    **

5.  ![image](http://1.gravatar.com/avatar/bcad85a0d0f1b5ac8fb904d59bc064c9?s=44&d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)[Thomas
    Burleson](http://solutionOptimist.com) [20 mins
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-15057)
    said:

    Here is a GIST that demonstrates what I meant:
    [https://gist.github.com/ThomasBurleson/9055159](https://gist.github.com/ThomasBurleson/9055159)

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=15057#respond)
    **

6.  ![image](http://1.gravatar.com/avatar/b3d0d27c01d183d7770c060f5e29e9ad?s=44&d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)[Michael
    Ryan (tracker1)](http://tracker1.info/) [about 1 min
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-15162)
    said:

    @ThomasBurleson I think that generators are a bit more natural and
    elegant to create than promises. The code when creating a promise
    just seems cumbersome to me, and likely always will. First, I don’t
    like that promises are usually used for what could just as easily be
    resolved by events (EventEmitter2 works well for this), or by
    callbacks (where async comes in handy).

    I think that generators are a really nice addition to ES6, and hope
    it sees widespread browser adoption (but that will take a while).
    They will likely be seen rapidly in the node.js echosystem, and very
    slow to be adopted in the browser. Just the same, I still tend to
    prefer events and callback flow over promises. Promises are really
    an attempt to jQuery-fy event flow.

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=15162#respond)
    **

7.  Pingback: [YUI Weekly for February 14th, 2014 - YUI
    Blog](http://www.yuiblog.com/blog/2014/02/14/yui-weekly-for-february-14th-2014/)

8.  ![image](http://0.gravatar.com/avatar/cc4b0c9de39095e1d04a8257246a9a09?s=44&d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D44&r=G)Herve
    [6 hours
    ago](http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/#comment-15210)
    said:

    Very good article, I didnt’t know about that !

    [Reply](/2014/02/10/replacing-callbacks-with-es6-generators/?replytocom=15210#respond)
    **

### [Cancel reply](/2014/02/10/replacing-callbacks-with-es6-generators/#respond)

**Your Name \*

**Your Email \*

**Website \*

### Web & Mobile Development News

[Web Standards Library Update – Week of March 31, 2014](http://flippinawesome.org/2014/04/10/web-standards-library-update-week-of-march-31-2014/ "Web Standards Library Update – Week of March 31, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Best of JavaScript, HTML & CSS – Week of March 31, 2014](http://flippinawesome.org/2014/04/09/best-of-javascript-html-css-march-31-2014/ "Best of JavaScript, HTML & CSS – Week of March 31, 2014")
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Web Standards Library Update – Week of March 24, 2014](http://flippinawesome.org/2014/04/03/web-standards-library-update-week-of-march-24-2014/ "Web Standards Library Update – Week of March 24, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Best of JavaScript, HTML & CSS – Week of March 24, 2014](http://flippinawesome.org/2014/04/02/best-of-javascript-html-css-week-of-march-24-2014/ "Best of JavaScript, HTML & CSS – Week of March 24, 2014")
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

[Web Standards Library Update – Week of March 17, 2014](http://flippinawesome.org/2014/03/26/web-standards-library-update-week-of-march-17-2014/ "Web Standards Library Update – Week of March 17, 2014")
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### Categories

-   [Best
    of](http://flippinawesome.org/category/news/best-of/ "View all posts filed under Best of")
-   [CSS](http://flippinawesome.org/category/web/css/ "View all posts filed under CSS")
-   [Design](http://flippinawesome.org/category/web/design/ "View all posts filed under Design")
-   [Featured](http://flippinawesome.org/category/featured/ "View all posts filed under Featured")
-   [Firefox
    OS](http://flippinawesome.org/category/mobile/firefox-os/ "View all posts filed under Firefox OS")
-   [Game
    Development](http://flippinawesome.org/category/web/game-development/ "View all posts filed under Game Development")
-   [HTML](http://flippinawesome.org/category/web/html/ "View all posts filed under HTML")
-   [JavaScript](http://flippinawesome.org/category/web/javascript/ "View all posts filed under JavaScript")
-   [Mobile](http://flippinawesome.org/category/mobile/ "View all posts filed under Mobile")
-   [News](http://flippinawesome.org/category/news/ "View all posts filed under News")
-   [NodeJS](http://flippinawesome.org/category/web/nodejs/ "View all posts filed under NodeJS")
-   [Opinion](http://flippinawesome.org/category/opinion/ "View all posts filed under Opinion")
-   [PhoneGap](http://flippinawesome.org/category/mobile/phonegap/ "View all posts filed under PhoneGap")
-   [Responsive Web
    Design](http://flippinawesome.org/category/responsive-web-design/ "View all posts filed under Responsive Web Design")
-   [Tools](http://flippinawesome.org/category/web/tools/ "View all posts filed under Tools")
-   [Web](http://flippinawesome.org/category/web/ "View all posts filed under Web")
-   [Wordpress](http://flippinawesome.org/category/web/wordpress/ "View all posts filed under Wordpress")

### Archives

-   [April 2014](http://flippinawesome.org/2014/04/)
-   [March 2014](http://flippinawesome.org/2014/03/)
-   [February 2014](http://flippinawesome.org/2014/02/)
-   [January 2014](http://flippinawesome.org/2014/01/)
-   [December 2013](http://flippinawesome.org/2013/12/)
-   [November 2013](http://flippinawesome.org/2013/11/)
-   [October 2013](http://flippinawesome.org/2013/10/)
-   [September 2013](http://flippinawesome.org/2013/09/)
-   [August 2013](http://flippinawesome.org/2013/08/)
-   [July 2013](http://flippinawesome.org/2013/07/)
-   [June 2013](http://flippinawesome.org/2013/06/)
-   [May 2013](http://flippinawesome.org/2013/05/)
-   [April 2013](http://flippinawesome.org/2013/04/)
-   [March 2013](http://flippinawesome.org/2013/03/)

-   [Flippin' Awesome](http://flippinawesome.org)
-   [Featured](http://flippinawesome.org/category/featured/)
-   Replacing callbacks with ES6 Generators

Copyright © 2012.

All content is licensed under the [Creative Commons
Attribution-Noncommercial-Share Alike 3.0 Unported
License](http://creativecommons.org/licenses/by-nc-sa/3.0/).

[Flippin' Awesome](http://flippinawesome.org/ "Flippin' Awesome")

[Top](#masthead "Scroll to top")

This markdown document has been converted from the html document located at:
http://flippinawesome.org/2014/02/10/replacing-callbacks-with-es6-generators/
